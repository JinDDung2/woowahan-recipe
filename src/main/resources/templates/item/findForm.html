<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="fragments/header :: headerFragment"/>
<style>
    .back-ground {
        background-color: #cccccc;
        border-radius: 10px;
        height: 65px;
        margin-top: 220px;
        margin-bottom: 10px;
        padding-top: 20px;
        padding-left: 20px;
    }

    button {
        padding: 10px 30px;
    }
</style>
<body>
<script type="text/javascript">
    /**
     * 장바구니 상품 담김 알림
     */
    function cartAlert() {
        alert("장바구니에 상품이 담겼습니다.");
        return;
    }

    /**
     * 아이템 수량 카운팅 +  총 금액 계산
     */
    function count(type) {
        // 결과를 표시할 element

        const resultCntElement = document.getElementById('cartItemCnt');
        const itemPrice = document.getElementById('itemPrice').value;

        let number = parseInt(resultCntElement.value);

        // 더하기/빼기
        if (type === 'plus') {
            if (number >= 10) {
                alert("수량은 10개 이하이어야 합니다.");
                return;
            }
            number += 1;
        } else if (type === 'minus') {
            if (number <= 1) {
                alert("수량은 1개 이상이어야 합니다.");
                resultCntElement.value = 1;
                return;
            }
            number -= 1;
        }
        document.getElementById('totalPrice').innerText = (itemPrice * number).toString();
        // 결과 출력
        resultCntElement.value = number;
    }

    function transferData() {
        const totalCost = parseInt(document.getElementById('totalPrice').innerText);
        const orderCreateReqDto = {
            itemId: [[${id}]],
            count: document.getElementById('cartItemCnt').value,
            deliveryCost: totalCost >= 50000 ? 0 : 3000,
            totalCost: totalCost
        }
        console.log(orderCreateReqDto.itemId)
        console.log(orderCreateReqDto.count)
        console.log(orderCreateReqDto.deliveryCost)
        console.log(orderCreateReqDto.totalCost)
        sessionStorage.setItem("orderCreateReqDto", JSON.stringify(orderCreateReqDto));
        window.location.href = "/items/" + [[${id}]] + "/order"
    }

</script>
<div th:replace="fragments/bodyHeader :: bodyHeaderFragment"/>
<div class="container" style="border: 1px solid white">
  <div th:if="${resDto.getSellerName() == #authentication.getPrincipal()}">
    <input style="width: 100px; float: right;"
           th:onclick="|location.href='@{/items/delete/{id}(id=${id})}'|" type="button" value="상품 삭제"/>
    <input style="width: 100px; float: right;"
           onclick="location.href='updateForm.html'"
           th:onclick="|location.href='@{/items/update/{id}(id=${id})}'|" type="button" value="상품 수정"/>
  </div>
  <div style="margin-top: 120px; border: 1px solid white" class="row">
    <div class="col">
      <p th:align="center"><img th:src="${imgPath}" class="card-img-top" alt="이미지 준비중입니다.">
    </div>
    <div style="padding-left: 150px" class="col">
      <div>
        <h1 th:text="${resDto.getItemName()}">상품명</h1>
      </div>
      <div>
        <h3><span th:text="${resDto.getItemPrice()}">상품 가격</span>원</h3>
      </div>
      <form role="form" th:action="@{/items/cart}" th:object="${cartItemReq}" method="post">
        <div class="back-ground">
          <input type="hidden" th:field="${cartItemReq.cartItemId}"/>
          <input type="hidden" id="itemPrice" th:value="${resDto.getItemPrice()}"/>
          <!--자바스크립트로 id로 값 받기 getElementById -> onclick할때 그 값을 보내도록-->
          <!--장바구니 수량 버튼-->
          <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
            <input style="width: 40px" type='button' onclick='count("minus")' value="-"/>
            <!--            <div style="width: 100px; border:1px solid; text-align: center; background-color: white" id='result'>0</div>-->
            <input style="width: 100px; border:1px solid; text-align: center; background-color: white" id='cartItemCnt'
                   name="cartItemCnt" th:value="${cartItemReq.cartItemCnt}"/>

            <input style="width: 40px" type='button' onclick='count("plus")' value="+"/>
          </div>

          <!--          <div style="margin-right: 30px; float: right" th:text="원">총 합계 금액</div>-->
          <div style="margin-right: 30px; float: right"><span id="totalPrice"
                                                              th:text="${resDto.getItemPrice()}">0</span>원
          </div>
        </div>

        <div style="border: 1px solid;">
          <input style="width: 100px; float: right;"
                 onclick="location.href='findAllForm.html'"
                 th:onclick="|location.href='@{/items}'|" type="button" value="목록으로"/>

          <input type="submit" value="장바구니" style="width: 100px; float: right;"/>
          <input type="button" value="바로구매" style="width: 100px; float: right;"
                 onclick='transferData()'>

        </div>
      </form>
    </div>
  </div>
  <hr>

</div>
</div>
<div th:replace="fragments/footer :: footerFragment"/>
</body>
</html>